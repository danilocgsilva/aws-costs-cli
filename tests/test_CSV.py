import unittest
from aws_costs_cli.CSV import CSV
from aws_costs_api.AWSCosts import AWSCosts
from aws_api_mock.CostExplorer import CostExplorer
from aws_costs_cli.functions import serviceTranslationBag

class test_CSV(unittest.TestCase):
    
    def setUp(self):
        self.csv = CSV()

    def test_get(self):

        awsCostExplorerMock = CostExplorer()
        awsCosts = AWSCosts(awsCostExplorerMock)
        self.csv.setAWSCostsClass(awsCosts)
        
        expected_string = '''2017-05-09 - 2017-05-09,0.5065006818156758
2017-05-10 - 2017-05-10,0.9377686945149113
2017-05-11 - 2017-05-11,0.8457328317673153
2017-05-12 - 2017-05-12,0.8283889161926373
2017-05-13 - 2017-05-13,0.8269929126304396
2017-05-14 - 2017-05-14,0.9381509479737521
2017-05-15 - 2017-05-15,0.8283510952889606
2017-05-16 - 2017-05-16,0.8282376282065929
2017-05-17 - 2017-05-17,0.8281756901483336
2017-05-18 - 2017-05-18,0.8282642744114878
'''
        
        returned_string = self.csv.get()
        
        self.assertEqual(returned_string, expected_string)
        
    def test_get_spread(self):
        self.maxDiff = None
        awsCostExplorerMock = CostExplorer()
        awsCosts = AWSCosts(awsCostExplorerMock)
        self.csv.setAWSCostsClass(awsCosts)
        self.csv.setSpread(serviceTranslationBag)
        
        expected_string = '''2017-05-09,tax,0.07750604831243847
2017-05-10,tax,0.0270957561413653
2017-05-11,tax,0.3716383862048105
2017-05-12,tax,0.00587164869451952
2017-05-13,tax,0.0299832912632027
2017-05-14,tax,0.737458871317735
2017-05-15,tax,0.074842643694743
2017-05-16,tax,0.595264991985727
2017-05-17,tax,0.000576420331467799
2017-05-18,tax,0.000860992817200966
2017-05-09,ec2,0.00023062766560844955
2017-05-10,ec2,0.2606873031952407
2017-05-11,ec2,0.0013544868433794071
2017-05-12,ec2,0.736754368657322
2017-05-13,ec2,0.372927787199885
2017-05-14,ec2,0.13996597163107
2017-05-15,ec2,0.13228242402978
2017-05-16,ec2,0.115540996885093
2017-05-17,ec2,0.165834114722552
2017-05-18,ec2,0.00516902388619041
2017-05-09,compute,0.00023062766560844955
2017-05-10,compute,6.991959144333819e-05
2017-05-11,compute,0.0019787699609398485
2017-05-12,compute,0.0541338762984979
2017-05-13,compute,0.000797423115319135
2017-05-14,compute,0.00198089159142963
2017-05-15,compute,0.000420580586643783
2017-05-16,compute,0.0418532304743227
2017-05-17,compute,0.229059552089792
2017-05-18,compute,0.102577544439013
2017-05-09,s3,0.06277746863558648
2017-05-10,s3,0.013362197214836651
2017-05-11,s3,0.1863271395640563
2017-05-12,s3,0.0253198289418126
2017-05-13,s3,0.147615957271569
2017-05-14,s3,0.0382445681771599
2017-05-15,s3,0.0322224514673983
2017-05-16,s3,0.060338551443287
2017-05-17,s3,0.0152395278877266
2017-05-18,s3,0.170561320097467
2017-05-09,workmail,0.0005650859427642049
2017-05-10,workmail,0.0017843835819167377
2017-05-11,workmail,0.014989036544669394
2017-05-12,workmail,0.00132222073376983
2017-05-13,workmail,0.231040508438865
2017-05-14,workmail,4.54488730488031e-06
2017-05-15,workmail,0.0682424932031637
2017-05-16,workmail,0.00645433680821152
2017-05-17,workmail,0.1228783585259
2017-05-18,workmail,0.207268058041531
2017-05-09,cloudwatch,0.01622120972822173
2017-05-10,cloudwatch,0.35781953456089244
2017-05-11,cloudwatch,0.08101186362064511
2017-05-12,cloudwatch,0.000203127889969165
2017-05-13,cloudwatch,0.0329626398249305
2017-05-14,cloudwatch,0.0149582152472998
2017-05-15,cloudwatch,0.0158979206696589
2017-05-16,cloudwatch,7.24410060169269e-06
2017-05-17,cloudwatch,0.00567982893371378
2017-05-18,cloudwatch,0.0777822440291448
2017-05-09,sns,0.33792137932933264
2017-05-10,sns,0.22200739727958446
2017-05-11,sns,0.006452084779391441
2017-05-12,sns,0.00222109692636827
2017-05-13,sns,0.00579219649437249
2017-05-14,sns,1.97992038796643e-05
2017-05-15,sns,0.360321525802614
2017-05-16,sns,0.00145881089123798
2017-05-17,sns,0.0383708494387319
2017-05-18,sns,0.226882921305569
2017-05-09,route53,0.00044697600173265045
2017-05-10,route53,0.011544074348980738
2017-05-11,route53,0.028675412093054266
2017-05-12,route53,0.00178406610111942
2017-05-13,route53,0.0020068905186178
2017-05-14,route53,0.00309686533141503
2017-05-15,route53,0.141266941704735
2017-05-16,route53,0.00478592161294431
2017-05-17,route53,0.240125336394165
2017-05-18,route53,0.0177547664106568
2017-05-09,rds,0.0019059481681484788
2017-05-10,rds,0.030156378441861344
2017-05-11,rds,0.028675412093054266
2017-05-12,rds,0.000428806746532002
2017-05-13,rds,1.15841295916939e-05
2017-05-14,rds,9.59715924056206e-05
2017-05-15,rds,0.000671827985764775
2017-05-16,rds,0.00106468584481057
2017-05-17,rds,0.00516561630058797
2017-05-18,rds,0.00965442237407066
2017-05-09,codecommit,0.0034959729024870434
2017-05-10,codecommit,0.003198798955589783
2017-05-11,codecommit,0.08634450604532178
2017-05-12,codecommit,3.15446211876148e-06
2017-05-13,codecommit,0.00266443381913916
2017-05-14,codecommit,0.00132431120725637
2017-05-15,codecommit,0.00124725221193314
2017-05-16,codecommit,0.00022564277879068
2017-05-17,codecommit,0.00268869755346995
2017-05-18,codecommit,0.00591105075003731
2017-05-09,dynamodb,0.0026248906690162195
2017-05-10,dynamodb,0.0065967739382003275
2017-05-11,dynamodb,0.015171487411262383
2017-05-12,dynamodb,0.000142014743730588
2017-05-13,dynamodb,0.000222039088770916
2017-05-14,dynamodb,0.000947275659777033
2017-05-15,dynamodb,0.00084680327724013
2017-05-16,dynamodb,5.00412573679218e-05
2017-05-17,dynamodb,0.00197987674496862
2017-05-18,dynamodb,0.0034392082003655
2017-05-09,kms,0.0016610571033699383
2017-05-10,kms,5.90082810675901e-05
2017-05-11,kms,0.00029279515269651585
2017-05-12,kms,6.37980431704079e-05
2017-05-13,kms,0.000294786357069851
2017-05-14,kms,2.60624525252578e-05
2017-05-15,kms,2.15787394733444e-05
2017-05-16,kms,0.000120886785353885
2017-05-17,kms,0.000340959737976411
2017-05-18,kms,2.54347135070538e-05
2017-05-09,cloudfront,2.1378637410903408e-05
2017-05-10,cloudfront,0.000837491200090579
2017-05-11,cloudfront,0.009717306916773654
2017-05-12,cloudfront,2.50960903483979e-05
2017-05-13,cloudfront,0.00057829454181199
2017-05-14,cloudfront,3.1653956449649e-06
2017-05-15,cloudfront,5.56867512237478e-05
2017-05-16,cloudfront,0.000207768482252608
2017-05-17,cloudfront,0.000235923568808333
2017-05-18,cloudfront,0.000183571739915512
2017-05-09,efs,0.0008907188622516529
2017-05-10,efs,0.002326208935844471
2017-05-11,efs,0.013094107931944828
2017-05-12,efs,6.13661984855237e-06
2017-05-13,efs,8.9047393279388e-05
2017-05-14,efs,1.24017325872558e-05
2017-05-15,efs,6.381194232934e-06
2017-05-16,efs,3.15222174444522e-05
2017-05-17,efs,7.98677974020386e-08
2017-05-18,efs,0.000191169013675179
2017-05-09,ce,1.292191698499126e-06
2017-05-10,ce,0.00022346884799679583
2017-05-11,ce,1.0036605315467037e-05
2017-05-12,ce,0.000109675243509909
2017-05-13,ce,6.03317401480726e-06
2017-05-14,ce,1.20325462618052e-05
2017-05-15,ce,4.58397035579067e-06
2017-05-16,ce,0.000832996639147523
2017-05-17,ce,5.48050675938945e-07
2017-05-18,ce,2.54659314354296e-06
'''

        returned_string = self.csv.get()
        
        self.assertEqual(returned_string, expected_string)
        
if __name__ == '__main__':
    unittest.main()
